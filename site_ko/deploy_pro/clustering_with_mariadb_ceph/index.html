<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>MariaDB와 Ceph 설정 - Server Seafile Manual</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "MariaDB와 Ceph 설정";
    var mkdocs_page_input_path = "deploy_pro/clustering_with_mariadb_ceph.md";
    var mkdocs_page_url = "/deploy_pro/clustering_with_mariadb_ceph/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Server Seafile Manual</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Summary</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>도입부</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>둘러보기</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../overview/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../overview/components/">Seafile 구성요소</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../overview/file_permission_management/">파일 권한 관리</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roadmap/">로드맵</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../faq/">자주 묻는 질문</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../changelog/">Changelog</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../contribution/">기여하기</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Linux에서 Seafile 가동</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/using_sqlite/">Seafile과 SQLite 가동</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/using_mysql/">Seafile과 MySQL 가동</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/deploy_with_nginx/">Seahub와 Nginx 설정</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/https_with_nginx/">Nginx https 활성화</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/deploy_with_apache/">Seahub와 Apache 설정</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/https_with_apache/">Apache https 활성화</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/using_ldap/">Seafile LDAP 사용 설정</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/shibboleth_config/">Seafile 시볼레스 인증 사용 설정</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/upgrade/">Seafile 서버 업그레이드</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>기타 가동 참고서</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/start_seafile_at_system_bootup/">시스템 부팅시 Seafile 시작하기</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/using_firewall/">방화벽 설정</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/using_logrotate/">Logrotate</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/add_memcached/">Memcached 추가</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/deploy_seafile_behind_nat/">NAT망에서 Seafile 가동</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/deploy_seahub_at_non-root_domain/">비 루트 영역에서 Seafile 가동</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/migrate_from_sqlite_to_mysql/">SQLite에서 MySQL로 이전</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../faq/">서버 설정 시 일반 문제</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/new_directory_layout_5_0_0/">Seafile 서버 5.0.0의 새 디렉터리 배치</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>윈도우에서 Seafile 가동</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/deploy_with_windows/">Deploy with windows</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/download_and_setup_seafile_windows_server/">Seafile 윈도우 서버 다운로드 및 설정</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/using_ldap/">윈도우에서 Seafile LDAP 사용 설정</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/deploy_with_mysql/">Seafile과 MySQL 가동</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/deploy_with_apache/">Seafile과 Apache 가동</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/deploy_with_apache/">Seafile과 Nginx 가동</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/install_seafile_server_as_a_windows_service/">윈도우 서비스로 Seafile 서버 설치</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/ports_used_by_seafile_windows_server/">Seafile 윈도우 서버에서 사용하는 포트</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/upgrading_seafile_windows_server/">Seafile 윈도우 서버 업그레이드</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/migrate_from_win_to_linux/">윈도우에서 리눅스로 Seafile 옮기기</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/windows_gc/">Seafile 서버 미사용 블록 가비지 콜렉션</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/windows_fsck/">손상된 저장소에 대해 seaf-fsck 실행</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Seafile 전문가판 가동</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../download_and_setup_seafile_professional_server/">Seafile 전문가 서버 다운로드 및 설치</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../migrate_from_seafile_community_server/">Seafile 커뮤니티 서버에서 옮기기</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../upgrading_seafile_professional_server/">Seafile 전문가 서버 업그레이드</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../using_ldap_pro/">Seafile 전문가판의 LDAP 설정</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../ldap_group_sync/">LDAP에서 그룹 가져오기</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configurable_options/">다중 단체 지원</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../office_documents_preview/">Office/PDF 문서 온라인 미리 보기 활성화</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../office_web_app/">오피스 웹 앱 통합</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../details_about_file_search/">파일 검색 세부 안내</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>바이러스 검사</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../virus_scan/">Virus scan</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../virus_scan_with_kav4fs/">kav4fs로 바이러스 검사</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../web_resumable_upload/">재개 가능한 웹 기반 파일 업로드</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>저장소 백엔드</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../setup_with_amazon_s3/">아마존 S3 백엔드</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../setup_with_ceph/">Ceph 백엔드</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../setup_with_swift/">오픈스택 Swift 백엔드</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>클러스터 가동</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../deploy_in_a_cluster/">클러스터에서 가동</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">MariaDB와 Ceph 설정</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#seafile-clustering-with-mariadb-and-ceph">Seafile Clustering with MariaDB and Ceph</a></li>
                
                    <li><a class="toctree-l4" href="#backgrounds">Backgrounds</a></li>
                
                    <li><a class="toctree-l4" href="#hardware-and-system-requirement">Hardware and system requirement</a></li>
                
                    <li><a class="toctree-l4" href="#setup-ceph-cluster">Setup Ceph cluster</a></li>
                
                    <li><a class="toctree-l4" href="#setup-mariadb-cluster">Setup MariaDB cluster</a></li>
                
                    <li><a class="toctree-l4" href="#setup-seafile-cluster">Setup Seafile cluster</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../setup_seafile_cluster_with_nfs/">NFS와 Seafile 클러스터 설정</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../enable_search_and_background_tasks_in_a_cluster/">클러스터에서 검색 및 백그라운드 작업 활성화</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../upgrade_a_cluster/">클러스터 업그레이드</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../real_time_backup/">실시간 백업 서버</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configurable_options/">설정 가능 항목</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../faq_for_seafile_pro_server/">자주 묻는 질문</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../seafile_professional_sdition_software_license_agreement/">라이선스</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>서버 설정 및 개별 설정</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/ccnet-conf/">ccnet.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/seafile-conf/">seafile.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/seahub_settings_py/">seahub_settings.py</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/seahub_customization/">Seahub 개별 설정</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/desktop_customization/">Desktop 클라이언트 개별 설정</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/sending_email/">전자메일 보내기</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/user_options/">사용자 관리 설정 항목</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/quota_and_size_options/">저장소 용량 제한 및 파일 크기 제한</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>관리</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../maintain/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../maintain/account/">계정 관리</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../maintain/logs/">로그</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../maintain/backup_recovery/">백업 및 복원</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../maintain/seafile_fsck/">Seafile FSCK</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../maintain/seafile_gc/">Seafile GC</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../maintain/clean_database/">데이터베이스 정리</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>WebDAV 및 FUSE 확장 기능</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../extension/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../extension/webdav/">WebDAV 확장 기능</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../extension/fuse/">FUSE 확장 기능</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>보안 및 감사</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../security/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../security/security_features/">보안 기능</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../security/auditing/">접근 기록 및 감사</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>개발</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/README/">README</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Seafile 빌드 방법</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/linux/">리눅스</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/freebsd/">FreeBSD</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/windows/">윈도우</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/osx/">Mac OS X</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/server/">서버</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/rpi/">라즈베리 파이</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/env/">개발 환경</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/code_standard/">코딩 표준</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/web_api/">웹 API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/web_api_v2.1/">웹 API V2.1</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/python_api/">파이썬 API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/php_api/">PHP API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/data_model/">데이터 모델</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/server-components/">서버 구성 요소</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/sync_algorithm/">동기화 알고리즘</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Server Seafile Manual</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Seafile 전문가판 가동 &raquo;</li>
        
      
        
          <li>클러스터 가동 &raquo;</li>
        
      
    
    <li>MariaDB와 Ceph 설정</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="seafile-clustering-with-mariadb-and-ceph">Seafile Clustering with MariaDB and Ceph</h1>
<p>In this document we describe the detailed solution of deploying a high scalable Seafile cluster with MariaDB and Ceph. The document is not a finished one. We will improve it continuously as our knowledge grow with several on going projects.</p>
<h2 id="backgrounds">Backgrounds</h2>
<p>Seafile organizes files into libraries. Each library is a GIT repository like file system tree with each file and folder identified by a unique hash value. These unique IDs are used in the syncing algorithm and there is no need to storing syncing state for each file in the database. Tranditional database like MySQL are not scalable to tens of millions of records, while object storages like Ceph and Swift are highly scalable. So in theory, Seafile is capable to storing billions of files for syncing and sharing.</p>
<p>While files are saved into object storage, other information like sharing and permission has to be stored in database. MariaDB Galera can be used to provide a scalable and reliable database storage.</p>
<h2 id="hardware-and-system-requirement">Hardware and system requirement</h2>
<p>In the minimum, we use three machines to setup the cluster. Each machine should be of</p>
<ul>
<li>4 cores with 8GB or more memory.</li>
<li>1 SSD disk to storing Ceph journal.</li>
<li>1 SATA disk to storing the operating system</li>
<li>1 SATA disk to storing MariaDB database</li>
<li>4 or more SATA disk to store Ceph data</li>
</ul>
<p>We use Ubuntu 14.04 server as the operating system. In the following, we denote the three server as node1, node2 and node3.</p>
<h2 id="setup-ceph-cluster">Setup Ceph cluster</h2>
<h4 id="preparation">Preparation</h4>
<p>Choose one node (say, node1) as admin node for installation. Install ceph-deploy on it.</p>
<ul>
<li>Add the release key:  </li>
</ul>
<pre><code>wget -q -O- 'https://ceph.com/git/?p=ceph.git;a=blob_plain;f=keys/release.asc' | sudo apt-key add -
</code></pre>

<ul>
<li>Add the Ceph packages to your repository. Replace {ceph-stable-release} with a stable Ceph release (e.g., emperor, firefly, giant etc.). The latest stable release is 'giant'.</li>
</ul>
<pre><code>echo deb http://ceph.com/debian-{ceph-stable-release}/ $(lsb_release -sc) main | sudo tee /etc/apt/sources.list.d/ceph.list
</code></pre>

<ul>
<li>Update your repository and install ceph-deploy:  </li>
</ul>
<pre><code>sudo apt-get update &amp;&amp; sudo apt-get install ceph-deploy
</code></pre>

<p>Install ntp on all nodes, and restart ntp  </p>
<pre><code>sudo apt-get install ntp
sudo service ntp restart
</code></pre>
<p>Install openssh on all nodes</p>
<pre><code>sudo apt-get install openssh-server
</code></pre>
<p>We'll use a non-root user for installation. Make sure this user has password-less sudo privileges.</p>
<pre><code>echo "{username} ALL = (root) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/{username}
sudo chmod 0440 /etc/sudoers.d/{username}
</code></pre>
<p>Generate ssh public key for the installation user on node1. Then copy that public key to other nodes <code>~/.ssh/authorized_keys</code>.</p>
<h4 id="create-ceph-cluster">Create Ceph Cluster</h4>
<p>Create a <code>ceph-cluster</code> directory on node1 for storing the generated config files. All commands should be run under this directory.</p>
<p>Install Ceph on all nodes</p>
<pre><code>ceph-deploy install node1 node2 node3
</code></pre>
<p>Create the cluster  </p>
<pre><code>ceph-deploy new node1 node2 node3
</code></pre>
<p>Create Ceph monitors. You should open port 6789 on all nodes.</p>
<pre><code>ceph-deploy mon create node1 node2 node3
</code></pre>
<p>Gather keys</p>
<pre><code>ceph-deploy gatherkeys node1
</code></pre>
<h4 id="add-osds">Add OSDs</h4>
<p>In Ceph, every OSD daemon manages one disk. The OSDs can share one SSD disk for journal.
Suppose the SSD disk for journal is <code>/dev/sdb</code> and the SATA disks are <code>/dev/sdc</code>, <code>/dev/sdd</code>, etc. Add OSDs by the following commands:</p>
<pre><code>ceph-deploy osd create node1:/dev/sdc:/dev/sdb
ceph-deploy osd create node2:/dev/sdc:/dev/sdb
ceph-deploy osd create node3:/dev/sdc:/dev/sdb
ceph-deploy osd create node1:/dev/sdd:/dev/sdb
ceph-deploy osd create node2:/dev/sdd:/dev/sdb
ceph-deploy osd create node3:/dev/sdd:/dev/sdb
</code></pre>
<p><strong>note</strong> By default Ceph uses a journal partition of size 5GB. The creation of OSD will fail if your journal disk is too small. You can add the following config to /etc/ceph/ceph.conf:</p>
<pre><code>[osd]
    # set journal size to 4GB
        osd journal size = 4000
</code></pre>

<h4 id="check-cluster-status">Check Cluster Status</h4>
<p>Ceph cluster setup is done. You can check cluster status by <code>sudo ceph -s</code>.</p>
<h4 id="references">References</h4>
<p>http://ceph.com/docs/master/rados/deployment/</p>
<h2 id="setup-mariadb-cluster">Setup MariaDB cluster</h2>
<h4 id="install-mariadb-and-galera">Install MariaDB and Galera</h4>
<p>First, set apt source for MariaDB and Galera. Choose a repository for 5.5 in <a href="https://downloads.mariadb.org/mariadb/repositories">this page</a>.
Then you can install mariadb and galera.</p>
<pre><code>sudo apt-get install mariadb-galera-server galera
sudo apt-get install rsync
</code></pre>
<h4 id="config-mariadb">Config MariaDB</h4>
<p>In <code>/etc/mysql/conf.d/cluster.cnf</code></p>
<pre><code>[mysqld]

query_cache_size=0
binlog_format=ROW
default-storage-engine=innodb
innodb_autoinc_lock_mode=2
query_cache_type=0
bind-address=0.0.0.0

# Galera Provider Configuration
wsrep_provider=/usr/lib/galera/libgalera_smm.so
#wsrep_provider_options="gcache.size=32G"

# Galera Cluster Configuration
wsrep_cluster_name="test_cluster"
wsrep_cluster_address="gcomm://first_ip,second_ip,third_ip

# Galera Synchronization Congifuration
wsrep_sst_method=rsync
#wsrep_sst_auth=user:pass

# Galera Node Configuration
wsrep_node_address="this_node_ip"
wsrep_node_name="this_node_name"
</code></pre>
<p>Here first_ip, second_ip and third_ip are corresponding to the IP address of node1, node2 and node3.</p>
<h4 id="change-the-data-directory-for-mariadb">Change the data directory for MariaDB</h4>
<p>We want to store the database data in a separate disk. Supposed the disk is mounted to the path <code>/mysql</code>.</p>
<p>Stop MariaDB using the following command:</p>
<pre><code>sudo /etc/init.d/mysql stop
</code></pre>
<p>Copy the existing data directory (default located in /var/lib/mysql) using the following command:</p>
<pre><code>sudo cp -R -p /var/lib/mysql/* /mysql
</code></pre>
<p>Edit /etc/mysql/my.cnf, update <code>datadir</code> option to <code>/mysql</code>.</p>
<p>Restart MariaDB with the command:</p>
<pre><code>sudo /etc/init.d/mysql restart
</code></pre>
<h4 id="start">Start</h4>
<p>Before staring the MariaDB cluster, make sure port 3456 and 4444 are open on all database nodes.</p>
<p>In node1:</p>
<pre><code>node1# sudo service mysql start --wsrep-new-cluster
</code></pre>
<p>In node2 and node3:</p>
<pre><code>node2# sudo service mysql start
node3# sudo service mysql start
</code></pre>
<h4 id="references_1">References</h4>
<p>https://www.digitalocean.com/community/tutorials/how-to-configure-a-galera-cluster-with-mariadb-on-ubuntu-12-04-servers</p>
<h2 id="setup-seafile-cluster">Setup Seafile cluster</h2>
<p>Please follow http://manual.seafile.com/deploy_pro/setup_with_ceph.html to set seafile with Ceph and follow http://manual.seafile.com/deploy_pro/deploy_in_a_cluster.html for setup Seafile cluster.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../setup_seafile_cluster_with_nfs/" class="btn btn-neutral float-right" title="NFS와 Seafile 클러스터 설정">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../deploy_in_a_cluster/" class="btn btn-neutral" title="클러스터에서 가동"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../deploy_in_a_cluster/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../setup_seafile_cluster_with_nfs/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
