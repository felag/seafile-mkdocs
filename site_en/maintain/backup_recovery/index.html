<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Backup and Recovery - Server Seafile Manual</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Backup and Recovery";
    var mkdocs_page_input_path = "maintain/backup_recovery.md";
    var mkdocs_page_url = "/maintain/backup_recovery/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Server Seafile Manual</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Summary</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Introduction</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../README/">README</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Overview</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../overview/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../overview/components/">Seafile Components</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../overview/file_permission_management/">File permission management</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../roadmap/">Roadmap</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../faq/">FAQ</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../changelog/">Changelog</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../contribution/">Contribution</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Deploying Seafile under Linux</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/using_sqlite/">Deploying Seafile with SQLite</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/using_mysql/">Deploying Seafile with MySQL</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/deploy_with_nginx/">Config Seahub with Nginx</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/https_with_nginx/">Enabling Https with Nginx</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/deploy_with_apache/">Config Seahub with Apache</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/https_with_apache/">Enabling Https with Apache</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/using_ldap/">Configure Seafile to use LDAP</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/shibboleth_config/">Configure Seafile to use Shibboleth Authentication</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/upgrade/">Upgrade Seafile server</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Other Deployment Notes</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/start_seafile_at_system_bootup/">Start Seafile at System Bootup</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/using_firewall/">Firewall settings</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/using_logrotate/">Logrotate</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/add_memcached/">Add Memcached</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/deploy_seafile_behind_nat/">Deploy Seafile behind NAT</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/deploy_seahub_at_non-root_domain/">Deploy Seahub at Non-root domain</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/migrate_from_sqlite_to_mysql/">Migrate From SQLite to MySQL</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../faq/">Common Problems for Setting up Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy/new_directory_layout_5_0_0/">New Directory Layout in Seafile Server 5.0.0</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Deploy Seafile under Windows</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/deploy_with_windows/">Deploy with windows</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/download_and_setup_seafile_windows_server/">Download and Setup Seafile Windows Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/using_ldap/">Configure Seafile to use LDAP on Windows</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/deploy_with_mysql/">Deploy Seafile with MySQL</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/deploy_with_apache/">Deploy Seafile with Apache</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/deploy_with_nginx/">Deploy Seafile with Nginx</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/install_seafile_server_as_a_windows_service/">Install Seafile Server as a Windows Service</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/ports_used_by_seafile_windows_server/">Ports used by Seafile Windows Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/upgrading_seafile_windows_server/">Upgrading Seafile Windows Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/migrate_from_win_to_linux/">Migrate Seafile From Windows To Linux</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/windows_gc/">Garbage Collecting Unused Blocks on Seafile Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_windows/windows_fsck/">Running seaf-fsck on corrupted repositories</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Deploy Seafile Pro Edition</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/download_and_setup_seafile_professional_server/">Download and Setup Seafile Professional Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/migrate_from_seafile_community_server/">Migrate from Seafile Community Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/upgrading_seafile_professional_server/">Upgrading Seafile Professional Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/using_ldap_pro/">LDAP Configuration for Seafile Pro</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/ldap_group_sync/">Importing Groups from LDAP</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/multi_institutions/">Multi-Institutions Support</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/office_documents_preview/">Enable Office/PDF Documents Online Preview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/office_web_app/">Integrating with Office Web App</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/details_about_file_search/">Details about File Search</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Virus Scan</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/virus_scan/">Virus scan</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/virus_scan_with_kav4fs/">Virus Scan With Kav4fs</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/web_resumable_upload/">Web Resumable File Upload</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Storage Backends</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/setup_with_amazon_s3/">Amazon S3 Backend</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/setup_with_ceph/">Ceph Backend</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/setup_with_swift/">OpenStack Swift Backend</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Cluster Deployment</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/deploy_in_a_cluster/">Deploy in a cluster</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/clustering_with_mariadb_ceph/">Setup with MariaDB and Ceph</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/setup_seafile_cluster_with_nfs/">Setup Seafile cluster with NFS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/enable_search_and_background_tasks_in_a_cluster/">Enable search and background tasks in a cluster</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/upgrade_a_cluster/">Upgrade a cluster</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/real_time_backup/">Real-time Backup Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/configurable_options/">Configurable Options</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/faq_for_seafile_pro_server/">FAQ</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../deploy_pro/seafile_professional_sdition_software_license_agreement/">License</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Server Configuration and Customization</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/ccnet-conf/">ccnet.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/seafile-conf/">seafile.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/seahub_settings_py/">seahub_settings.py</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/seahub_customization/">Seahub customization</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/desktop_customization/">Desktop client customization</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/sending_email/">Email Sending</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/user_options/">User management options</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../config/quota_and_size_options/">Storage Quota and File size limits</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Administration</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../account/">Account management</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../logs/">Logs</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Backup and Recovery</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#overview">Overview</a></li>
                
            
                <li class="toctree-l3"><a href="#backup-steps">Backup steps</a></li>
                
                    <li><a class="toctree-l4" href="#backup-order-database-first-or-data-directory-first">Backup Order: Database First or Data Directory First</a></li>
                
                    <li><a class="toctree-l4" href="#backing-up-databases">Backing up Databases</a></li>
                
                    <li><a class="toctree-l4" href="#backing-up-seafile-library-data">Backing up Seafile library data</a></li>
                
            
                <li class="toctree-l3"><a href="#restore-from-backup">Restore from backup</a></li>
                
                    <li><a class="toctree-l4" href="#restore-the-databases">Restore the databases</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../seafile_fsck/">Seafile FSCK</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../seafile_gc/">Seafile GC</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../clean_database/">Clean database</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>WebDAV and FUSE extensions</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../extension/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../extension/webdav/">WebDAV extension</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../extension/fuse/">FUSE extension</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Security and Auditing</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../security/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../security/security_features/">Security features</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../security/auditing/">Access logs and auditing</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Developing</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/README/">README</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>How to Build Seafile</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/README/">README</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/linux/">Linux</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/freebsd/">FreeBSD</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/windows/">Windows</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/osx/">Mac OS X</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/server/">Server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../build_seafile/rpi/">Raspberry Pi</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/env/">Develop env</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/code_standard/">Code Standard</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/web_api/">Web API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/web_api_v2.1/">Web API V2.1</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/python_api/">Python API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/php_api/">PHP API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/data_model/">Data Model</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/server-components/">Server Components</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../develop/sync_algorithm/">Sync algorithm</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Server Seafile Manual</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Administration &raquo;</li>
        
      
    
    <li>Backup and Recovery</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="overview">Overview</h2>
<p>There are generally two parts of data to backup</p>
<ul>
<li>Seafile library data</li>
<li>Databases</li>
</ul>
<p>If you setup seafile server according to our manual, you should have a directory layout like:</p>
<pre><code>haiwen       # Replace the name with your organization name
  --seafile-server-2.x.x # untar from seafile package
  --seafile-data   # seafile configuration and data (if you choose the default)
  --seahub-data    # seahub data
  --ccnet          # ccnet configuration and data 
  --seahub.db      # sqlite3 database used by seahub
  --seahub_settings.py # optional config file for seahub
</code></pre>
<p>All your library data is stored under the 'haiwen' directory.</p>
<p>Seafile also stores some important metadata data in a few databases. The names and locations of these databases depends on which database software you use.</p>
<p>For SQLite, the database files are also under the 'haiwen' directory. The locations are:</p>
<ul>
<li>ccnet/PeerMgr/usermgr.db: contains user information</li>
<li>ccnet/GroupMgr/groupmgr.db: contains group information</li>
<li>seafile-data/seafile.db: contains library metadata</li>
<li>seahub.db: contains tables used by the web front end (seahub)</li>
</ul>
<p>For MySQL, the databases are created by the administrator, so the names can be different from one deployment to another. There are 3 databases:</p>
<ul>
<li>ccnet-db: contains user and group information</li>
<li>seafile-db: contains library metadata</li>
<li>seahub.db: contains tables used by the web front end (seahub)</li>
</ul>
<h2 id="backup-steps">Backup steps</h2>
<p>The backup is a three step procedure:</p>
<ol>
<li>Optional: Stop Seafile server first if you're using SQLite as database.</li>
<li>Backup the databases;</li>
<li>Backup the seafile data directory;</li>
</ol>
<h3 id="backup-order-database-first-or-data-directory-first">Backup Order: Database First or Data Directory First</h3>
<ul>
<li>backup data directory first, SQL later: When you're backing up data directory, some new objects are written and they're not backed up. Those new objects may be referenced in SQL database. So when you restore, some records in the database cannot find its object. So the library is corrupted.</li>
<li>backup SQL first, data directory later: Since you backup database first, all records in the database have valid objects to be referenced. So the libraries won't be corrupted. But new objects written to storage when you're backing up are not referenced by database records. So some libraries are out of date. When you restore, some new data are lost.</li>
</ul>
<p>The second sequence is better in the sense that it avoids library corruption. Like other backup solutions, some new data can be lost in recovery. There is always a backup window.
However, if your storage backup mechanism can finish quickly enough, using the first sequence can retain more data.</p>
<p>We assume your seafile data directory is in <code>/data/haiwen</code>. And you want to backup to <code>/backup</code> directory. The <code>/backup</code> can be an NFS or Windows share mount exported by another machine, or just an external disk. You can create a layout similar to the following in <code>/backup</code> directory:</p>
<pre><code>/backup
---- databases/  contains database backup files
---- data/  contains backups of the data directory
</code></pre>
<h3 id="backing-up-databases">Backing up Databases</h3>
<p>It's recommended to backup the database to a separate file each time. Don't overwrite older database backups for at least a week.</p>
<p><strong>MySQL</strong></p>
<p>Assume your database names are <code>ccnet-db</code>, <code>seafile-db</code> and <code>seahub-db</code>. mysqldump automatically locks the tables so you don't need to stop Seafile server when backing up MySQL databases. Since the database tables are usually very small, it won't take long to dump.</p>
<pre><code>mysqldump -h [mysqlhost] -u[username] -p[password] --opt ccnet-db &gt; /backup/databases/ccnet-db.sql.`date +"%Y-%m-%d-%H-%M-%S"`

mysqldump -h [mysqlhost] -u[username] -p[password] --opt seafile-db &gt; /backup/databases/seafile-db.sql.`date +"%Y-%m-%d-%H-%M-%S"`

mysqldump -h [mysqlhost] -u[username] -p[password] --opt seahub-db &gt; /backup/databases/seahub-db.sql.`date +"%Y-%m-%d-%H-%M-%S"`
</code></pre>
<p><strong>SQLite</strong></p>
<p>You need to stop Seafile server first before backing up SQLite database.</p>
<pre><code>sqlite3 /data/haiwen/ccnet/GroupMgr/groupmgr.db .dump &gt; /backup/databases/groupmgr.db.bak.`date +"%Y-%m-%d-%H-%M-%S"`

sqlite3 /data/haiwen/ccnet/PeerMgr/usermgr.db .dump &gt; /backup/databases/usermgr.db.bak.`date +"%Y-%m-%d-%H-%M-%S"`

sqlite3 /data/haiwen/seafile-data/seafile.db .dump &gt; /backup/databases/seafile.db.bak.`date +"%Y-%m-%d-%H-%M-%S"`

sqlite3 /data/haiwen/seahub.db .dump &gt; /backup/databases/seahub.db.bak.`date +"%Y-%m-%d-%H-%M-%S"`
</code></pre>
<h3 id="backing-up-seafile-library-data">Backing up Seafile library data</h3>
<p>The data files are all stored in the <code>/data/haiwen</code> directory, so just back up the whole directory. You can directly copy the whole directory to the backup destination, or you can use rsync to do incremental backup. </p>
<p>To directly copy the whole data directory,</p>
<pre><code>cp -R /data/haiwen /backup/data/haiwen-`date +"%Y-%m-%d-%H-%M-%S"`
</code></pre>
<p>This produces a separate copy of the data directory each time. You can delete older backup copies after a new one is completed.</p>
<p>If you have a lot of data, copying the whole data directory would take long. You can use rsync to do incremental backup.</p>
<pre><code>rsync -az /data/haiwen /backup/data
</code></pre>
<p>This command backup the data directory to <code>/backup/data/haiwen</code>.</p>
<h2 id="restore-from-backup">Restore from backup</h2>
<p>Now supposed your primary seafile server is broken, you're switching to a new machine. Using the backup data to restore your Seafile instance:</p>
<ol>
<li>Copy <code>/backup/data/haiwen</code> to the new machine. Let's assume the seafile deployment location new machine is also <code>/data/haiwen</code>.</li>
<li>Restore the database.</li>
<li>Since database and data are backed up separately, they may become a little inconsistent with each other. To correct the potential inconsistency, run seaf-fsck tool to check data integrity on the new machine. See <a href="../seafile_fsck/">seaf-fsck documentation</a>.</li>
</ol>
<h3 id="restore-the-databases">Restore the databases</h3>
<p>Now with the latest valid database backup files at hand, you can restore them.</p>
<p><strong>MySQL</strong></p>
<pre><code>mysql -u[username] -p[password] ccnet-db &lt; ccnet-db.sql.2013-10-19-16-00-05
mysql -u[username] -p[password] seafile-db &lt; seafile-db.sql.2013-10-19-16-00-20
mysql -u[username] -p[password] seahub-db &lt; seahub-db.sql.2013-10-19-16-01-05
</code></pre>
<p><strong>SQLite</strong></p>
<pre><code>cd /data/haiwen
mv ccnet/PeerMgr/usermgr.db ccnet/PeerMgr/usermgr.db.old
mv ccnet/GroupMgr/groupmgr.db ccnet/GroupMgr/groupmgr.db.old
mv seafile-data/seafile.db seafile-data/seafile.db.old
mv seahub.db seahub.db.old
sqlite3 ccnet/PeerMgr/usermgr.db &lt; usermgr.db.bak.xxxx
sqlite3 ccnet/GroupMgr/groupmgr.db &lt; groupmgr.db.bak.xxxx
sqlite3 seafile-data/seafile.db &lt; seafile.db.bak.xxxx
sqlite3 seahub.db &lt; seahub.db.bak.xxxx
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../seafile_fsck/" class="btn btn-neutral float-right" title="Seafile FSCK">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../logs/" class="btn btn-neutral" title="Logs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../logs/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../seafile_fsck/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
